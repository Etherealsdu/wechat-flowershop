<!-- pages/checkout/checkout.wxml -->
<view class="container">
  <!-- Header -->
  <view class="header">
    <text class="header-back" bindtap="goBack">‚Üê</text>
    <text class="header-title">{{i18n.title}}</text>
  </view>

  <!-- Delivery Address -->
  <view class="card mb-3">
    <view class="p-3">
      <view class="section-header mb-3">
        <text class="section-title">{{i18n.deliveryAddress}}</text>
        <text class="section-more" bindtap="editAddress" wx:if="{{address}}">{{i18n.editAddress}}</text>
      </view>

      <view wx:if="{{address}}">
        <text class="address-line">{{address.name}}</text>
        <text class="address-line">{{address.phone}}</text>
        <text class="address-line">{{address.street}}</text>
        <text class="address-line">{{address.city}}, {{address.state}} {{address.zipcode}}</text>
        <text class="address-line">{{address.country}}</text>
      </view>
      <view wx:else>
        <text>{{i18n.noAddress}}</text>
        <button class="btn btn-primary mt-2" bindtap="addAddress">{{i18n.addAddress}}</button>
      </view>
    </view>
  </view>

  <!-- Delivery Time -->
  <view class="card mb-3">
    <view class="p-3">
      <view class="section-header mb-3">
        <text class="section-title">{{i18n.deliveryTime}}</text>
      </view>

      <radio-group bindchange="onDeliveryTimeChange">
        <label class="delivery-option flex align-center" wx:for="{{deliveryOptions}}" wx:key="value">
          <radio value="{{item.value}}" checked="{{item.value === selectedDeliveryTime}}"/>
          <view class="ml-2">
            <text class="delivery-label">{{item.label}}</text>
            <text class="delivery-time text-muted" wx:if="{{item.time}}">{{item.time}}</text>
          </view>
        </label>
      </radio-group>
    </view>
  </view>

  <!-- Special Instructions -->
  <view class="card mb-3">
    <view class="p-3">
      <view class="section-header mb-3">
        <text class="section-title">{{i18n.specialInstructions}}</text>
      </view>
      <textarea
        class="instructions-input"
        placeholder="{{i18n.specialInstructionsPlaceholder}}"
        value="{{specialInstructions}}"
        bindinput="onInstructionsInput"
        maxlength="200"
      ></textarea>
    </view>
  </view>

  <!-- Order Summary -->
  <view class="card mb-3">
    <view class="p-3">
      <view class="section-header mb-3">
        <text class="section-title">{{i18n.orderSummary}}</text>
      </view>

      <block wx:for="{{cartItems}}" wx:key="id">
        <view class="summary-item flex justify-between mb-2">
          <text>{{item.name}} x {{item.quantity}}</text>
          <text>${{toFixed(item.price * item.quantity, 2)}}</text>
        </view>
      </block>

      <view class="divider mb-2"></view>

      <view class="summary-row justify-between mb-1">
        <text>{{i18n.subtotal}}:</text>
        <text>${{toFixed(subtotal, 2)}}</text>
      </view>
      <view class="summary-row justify-between mb-1">
        <text>{{i18n.deliveryFee}}:</text>
        <text wx:if="{{deliveryFee > 0}}">${{deliveryFee}}</text>
        <text wx:else>{{i18n.freeDelivery}}</text>
      </view>
      <view class="summary-row justify-between mb-1" wx:if="{{discount > 0}}">
        <text>{{i18n.discount}}:</text>
        <text>-${{discount}}</text>
      </view>
      <view class="divider mb-2"></view>
      <view class="summary-row justify-between bold">
        <text>{{i18n.total}}:</text>
        <text class="total-amount">${{toFixed(total, 2)}}</text>
      </view>
    </view>
  </view>

  <!-- Place Order Button -->
  <view class="p-3">
    <button class="btn btn-primary btn-large" bindtap="placeOrder" disabled="{{!address || cartItems.length === 0}}">{{i18n.placeOrder}}</button>
  </view>
</view>
